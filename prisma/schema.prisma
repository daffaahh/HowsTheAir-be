// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AirQuality {
  id                Int                @id @default(autoincrement())
  stationName       String            
  monitoredCityId   Int                @unique // WAJIB UNIQUE: satu kota cuma punya 1 data terbaru
  aqi               Int               
  category          String            
  recordedAt        DateTime          
  lastSynced        DateTime          @default(now()) @updatedAt
}

model AirQualityHistory {
  id              Int      @id @default(autoincrement())
  monitoredCityId Int       
  aqi             Int
  category        String
  recordedAt      DateTime
  SyncedAt        DateTime @default(now())

  // UNIQUE: Mencegah data stasiun yang sama di jam yang sama masuk dua kali ke history 
  @@unique([monitoredCityId, recordedAt])
}

// For Check SYNC, get from here
model AuditLog {
  id          Int      @id @default(autoincrement())
  action      String   // 'SYNC', 'CREATE', 'UPDATE', 'DELETE'
  details     String?  // Misal: "Synced 5 cities" atau "Deleted ID 4"
  status      String   // 'SUCCESS', 'FAILED'
  performedAt DateTime @default(now())
}

model MonitoredCity {
  id        Int      @id @default(autoincrement())
  name      String   
  keyword   String   @unique 
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}